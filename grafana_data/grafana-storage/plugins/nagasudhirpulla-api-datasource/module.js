define(["@grafana/data","@grafana/runtime","@grafana/ui","lodash","react"],((e,t,r,n,i)=>(()=>{"use strict";var o=[e=>{e.exports=i},e=>{e.exports=r},,t=>{t.exports=e},e=>{e.exports=t},e=>{e.exports=n}],a={};function s(e){var t=a[e];if(void 0!==t)return t.exports;var r=a[e]={exports:{}};return o[e](r,r.exports,s),r.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var l={};return(()=>{s.r(l),s.d(l,{plugin:()=>$});var e=s(3);function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},n(e,t)}function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=c(e);if(t){var i=c(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return o(this,r)}}function o(e,r){if(r&&("object"===t(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return a(e)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&n(e,t)}(c,e);var t,o,s,l=i(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),u(a(t=l.call(this,e)),"url",void 0),u(a(t),"schema",void 0),t.url=e.url,t.schema=e.jsonData.schema,t}return t=c,o&&r(t.prototype,o),s&&r(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}(s(4).DataSourceWithBackend),p=s(1),d=s(0),h=s.n(d),y=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},_=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},g=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},v=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},b=void 0;b="undefined"!=typeof window?window:"undefined"!=typeof self?self:s.g;var w=null,O=null,z=b.clearTimeout,E=b.setTimeout,j=b.cancelAnimationFrame||b.mozCancelAnimationFrame||b.webkitCancelAnimationFrame,S=b.requestAnimationFrame||b.mozRequestAnimationFrame||b.webkitRequestAnimationFrame;function R(e){var t=void 0,r=void 0,n=void 0,i=void 0,o=void 0,a=void 0,s=void 0,l="undefined"!=typeof document&&document.attachEvent;if(!l){a=function(e){var t=e.__resizeTriggers__,r=t.firstElementChild,n=t.lastElementChild,i=r.firstElementChild;n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight,i.style.width=r.offsetWidth+1+"px",i.style.height=r.offsetHeight+1+"px",r.scrollLeft=r.scrollWidth,r.scrollTop=r.scrollHeight},o=function(e){return e.offsetWidth!==e.__resizeLast__.width||e.offsetHeight!==e.__resizeLast__.height},s=function(e){if(!(e.target.className&&"function"==typeof e.target.className.indexOf&&e.target.className.indexOf("contract-trigger")<0&&e.target.className.indexOf("expand-trigger")<0)){var t=this;a(this),this.__resizeRAF__&&w(this.__resizeRAF__),this.__resizeRAF__=O((function(){o(t)&&(t.__resizeLast__.width=t.offsetWidth,t.__resizeLast__.height=t.offsetHeight,t.__resizeListeners__.forEach((function(r){r.call(t,e)})))}))}};var c=!1,u="";n="animationstart";var f="Webkit Moz O ms".split(" "),p="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),d=document.createElement("fakeelement");if(void 0!==d.style.animationName&&(c=!0),!1===c)for(var h=0;h<f.length;h++)if(void 0!==d.style[f[h]+"AnimationName"]){u="-"+f[h].toLowerCase()+"-",n=p[h],c=!0;break}t="@"+u+"keyframes "+(r="resizeanim")+" { from { opacity: 0; } to { opacity: 0; } } ",i=u+"animation: 1ms "+r+"; "}return{addResizeListener:function(o,c){if(l)o.attachEvent("onresize",c);else{if(!o.__resizeTriggers__){var u=o.ownerDocument,f=b.getComputedStyle(o);f&&"static"===f.position&&(o.style.position="relative"),function(r){if(!r.getElementById("detectElementResize")){var n=(t||"")+".resize-triggers { "+(i||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',o=r.head||r.getElementsByTagName("head")[0],a=r.createElement("style");a.id="detectElementResize",a.type="text/css",null!=e&&a.setAttribute("nonce",e),a.styleSheet?a.styleSheet.cssText=n:a.appendChild(r.createTextNode(n)),o.appendChild(a)}}(u),o.__resizeLast__={},o.__resizeListeners__=[],(o.__resizeTriggers__=u.createElement("div")).className="resize-triggers";var p=u.createElement("div");p.className="expand-trigger",p.appendChild(u.createElement("div"));var d=u.createElement("div");d.className="contract-trigger",o.__resizeTriggers__.appendChild(p),o.__resizeTriggers__.appendChild(d),o.appendChild(o.__resizeTriggers__),a(o),o.addEventListener("scroll",s,!0),n&&(o.__resizeTriggers__.__animationListener__=function(e){e.animationName===r&&a(o)},o.__resizeTriggers__.addEventListener(n,o.__resizeTriggers__.__animationListener__))}o.__resizeListeners__.push(c)}},removeResizeListener:function(e,t){if(l)e.detachEvent("onresize",t);else if(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),!e.__resizeListeners__.length){e.removeEventListener("scroll",s,!0),e.__resizeTriggers__.__animationListener__&&(e.__resizeTriggers__.removeEventListener(n,e.__resizeTriggers__.__animationListener__),e.__resizeTriggers__.__animationListener__=null);try{e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)}catch(e){}}}}}null==j||null==S?(w=z,O=function(e){return E(e,20)}):(w=function(e){var t=v(e,2),r=t[0],n=t[1];j(r),z(n)},O=function(e){var t=S((function(){z(r),e()})),r=E((function(){j(t),e()}),20);return[t,r]});var T=function(e){function t(){var e,r,n;y(this,t);for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return r=n=g(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),n.state={height:n.props.defaultHeight||0,width:n.props.defaultWidth||0},n._onResize=function(){var e=n.props,t=e.disableHeight,r=e.disableWidth,i=e.onResize;if(n._parentNode){var o=n._parentNode.offsetHeight||0,a=n._parentNode.offsetWidth||0,s=window.getComputedStyle(n._parentNode)||{},l=parseInt(s.paddingLeft,10)||0,c=parseInt(s.paddingRight,10)||0,u=parseInt(s.paddingTop,10)||0,f=parseInt(s.paddingBottom,10)||0,p=o-u-f,d=a-l-c;(!t&&n.state.height!==p||!r&&n.state.width!==d)&&(n.setState({height:o-u-f,width:a-l-c}),i({height:o,width:a}))}},n._setRef=function(e){n._autoSizer=e},g(n,r)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),_(t,[{key:"componentDidMount",value:function(){var e=this.props.nonce;this._autoSizer&&this._autoSizer.parentNode&&this._autoSizer.parentNode.ownerDocument&&this._autoSizer.parentNode.ownerDocument.defaultView&&this._autoSizer.parentNode instanceof this._autoSizer.parentNode.ownerDocument.defaultView.HTMLElement&&(this._parentNode=this._autoSizer.parentNode,this._detectElementResize=R(e),this._detectElementResize.addResizeListener(this._parentNode,this._onResize),this._onResize())}},{key:"componentWillUnmount",value:function(){this._detectElementResize&&this._parentNode&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize)}},{key:"render",value:function(){var e=this.props,t=e.children,r=e.className,n=e.disableHeight,i=e.disableWidth,o=e.style,a=this.state,s=a.height,l=a.width,c={overflow:"visible"},u={},f=!1;return n||(0===s&&(f=!0),c.height=0,u.height=s),i||(0===l&&(f=!0),c.width=0,u.width=l),(0,d.createElement)("div",{className:r,ref:this._setRef,style:m({},c,o)},!f&&t(u))}}]),t}(d.PureComponent);T.defaultProps={onResize:function(){},disableHeight:!1,disableWidth:!1,style:{}};const N=T;var P;function C(){return C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},C.apply(this,arguments)}var L,A=s(5),x={payload:""};function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function F(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return k(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function W(){return W=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},W.apply(this,arguments)}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function M(e,t){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},M(e,t)}function B(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=U(e);if(t){var i=U(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return q(this,r)}}function q(e,t){if(t&&("object"===I(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return J(e)}function J(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(e){return U=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},U(e)}function Q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var V=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&M(e,t)}(o,e);var t,r,n,i=B(o);function o(){var e;D(this,o);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return Q(J(e=i.call.apply(i,[this].concat(r))),"onPayloadChange",(function(t){var r=e.props;(0,r.onChange)(W({},r.query,{payload:t}))})),Q(J(e),"onAliasChange",(function(t){var r=e.props;(0,r.onChange)(W({},r.query,{alias:t.currentTarget.value}))})),Q(J(e),"iterateSchema",(function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=e.props.query.payload,a=function(){try{return JSON.parse(o)}catch(e){return{}}}(),s=function(o){var s;if(!t.properties.hasOwnProperty(o))return"continue";var l=t.properties[o];if("boolean"==typeof l)return"continue";var c=l.type;if("string"!=typeof c)return"continue";var u=(0,A.get)(a,[].concat(F(r),[o]),l.default),f=null!==(s=l.title)&&void 0!==s?s:o,d=e.onPayloadChange;if(l.hasOwnProperty("enum")){if(-1===["number","string","integer"].indexOf(c))return"continue";var y=l.enum;if(!Array.isArray(y))return"continue";var _=y.map((function(e){return{label:""+e,value:"string"===c?"".concat(e):parseFloat("".concat(e))}})),m=h().createElement(p.InlineFieldRow,null,h().createElement(p.InlineLabel,{tooltip:l.description},[].concat(F(n),[f]).join(".")),h().createElement(p.Select,{options:_,value:u,onChange:function(e){var t=(0,A.setWith)(a,[].concat(F(r),[o]),e.value,Object);d(JSON.stringify(t))}}));i.push(m)}else if("number"===c||"integer"===c||"string"===c){var g=h().createElement(p.InlineFieldRow,null,h().createElement(p.InlineLabel,{tooltip:l.description},[].concat(F(n),[f]).join(".")),h().createElement(p.Input,{width:12,value:u,onChange:function(e){var t=!0,n=e.currentTarget.value;if("number"===c?(n=parseFloat(n),t=!isNaN(n)):"integer"===c&&(n=parseInt(n,10),t=!isNaN(n)),t){var i=(0,A.setWith)(a,[].concat(F(r),[o]),n,Object);d(JSON.stringify(i))}}}));i.push(g)}else if("boolean"===c){var v=h().createElement(p.InlineFieldRow,null,h().createElement(p.InlineLabel,{tooltip:l.description},[].concat(F(n),[f]).join(".")),h().createElement(p.Switch,{value:u,onChange:function(e){var t=(0,A.setWith)(a,[].concat(F(r),[o]),e.currentTarget.checked,Object);d(JSON.stringify(t))}}));i.push(v)}};for(var l in t.properties)s(l);return i})),e}return t=o,(r=[{key:"render",value:function(){var e,t=(0,A.defaults)(this.props.query,x).alias,r=null!==(e=this.props.datasource.schema)&&void 0!==e?e:{};return h().createElement(h().Fragment,null,h().createElement(p.InlineFieldRow,null,L||(L=h().createElement(p.InlineLabel,{tooltip:"If left blank, the field uses the name of the queried element."},"Alias")),h().createElement(p.Input,{width:12,value:t,onChange:this.onAliasChange})),h().createElement(h().Fragment,null,this.iterateSchema(r,[],[],[])))}}])&&H(t.prototype,r),n&&H(t,n),Object.defineProperty(t,"prototype",{writable:!1}),o}(d.PureComponent),$=new e.DataSourcePlugin(f).setConfigEditor((function(e){var t=e.options,r=e.onOptionsChange,n=function(){try{return JSON.stringify(t.jsonData.schema,null,"\t")}catch(e){return""}}();return h().createElement(h().Fragment,null,h().createElement(p.DataSourceHttpSettings,{defaultUrl:"http://localhost:8080",dataSourceConfig:t,showAccessOptions:!0,onChange:r}),h().createElement(p.InlineFieldRow,null,h().createElement(N,{disableHeight:!0},(function(e){var i=e.width;return h().createElement("div",{style:{width:i+"px"}},P||(P=h().createElement(p.InlineLabel,null,"Query Schema")),h().createElement(p.CodeEditor,{width:"100%",height:"200px",language:"json",showLineNumbers:!0,showMiniMap:(null!=n?n:"").length>100,value:n,onBlur:function(e){var n=function(){try{return JSON.parse(e)}catch(e){return{}}}();r(C({},t,{jsonData:C({},t.jsonData,{schema:n})}))}}))}))))})).setQueryEditor(V)})(),l})()));
//# sourceMappingURL=module.js.map